"use strict";let albumIdData=[],albumUploadData=[];function dedecmsAlbumDelete(that){$(that).parent().parent().parent().parent().remove()}function dedecmsAlbumEdit(that){let files=$(that).prop("files");if(files){let file=files[0];if(void 0===file)return;if(/\.(jpe?g|png|gif)$/i.test(file.name)){let reader=new FileReader;reader.onload=function(){let img=$(that).next(),input=$(that).parent().next().children().children("input"),src=this.result,remark=file.name.substring(0,file.name.lastIndexOf("."));img.attr("src",src),input.val(remark),input.attr("value",input.val())},reader.readAsDataURL(file)}}}function dedecmsAlbumDataUpdate(){let albumIds=$("#dedecms-album-ids");albumIdData=[],$(".dedecms-album-id").each((function(){let id=$(this).attr("id");id=id.replace("albumId",""),-1===albumIdData.indexOf(id)&&albumIdData.push(id)})),albumIds.val(JSON.stringify(albumIdData))}function dedecmsAlbumPreview(that){let files=$(that).prop("files"),albumPreview=$("#dedecms-album-preview"),albumUploadFiles=$("#dedecms-album-upload-files");files&&$.each(files,(function(i,file){if(void 0!==file&&/\.(jpe?g|png|gif)$/i.test(file.name)){let reader=new FileReader;reader.onload=function(){let timestamp,id=""+(new Date).valueOf()+random(1e3,9999),src=this.result,remark=file.name.substring(0,file.name.lastIndexOf(".")),html=`\n                    <div class="dedecms-album-preview-id" id="${id}">\n                        <div class="uk-card uk-card-default">\n                            <div class="uk-card-header uk-padding-small">\n                                <div class="uk-flex uk-flex-between">\n                                    <span class="uk-sortable-handle" uk-icon="icon: arrows-move"></span>\n                                    <button type="button" uk-close onclick="dedecmsAlbumPreviewDelete(this)"></button>\n                                </div>\n                            </div>\n                            <div class="uk-card-body uk-padding-remove uk-text-center" uk-form-custom>\n                                <input type="file" accept="image/*" onchange="dedecmsAlbumPreviewEdit(this)">\n                                <img class="uk-height-small dedecms-album-preview-src" src="${src}">\n                                <div>点击图片进行修改</div>\n                            </div>\n                            <div class="uk-card-footer uk-padding-small">\n                                <div class="uk-flex uk-flex-middle">\n                                    <label class="uk-form-label uk-width-auto uk-margin-small-right">注释</label>\n                                    <input class="uk-input uk-form-small uk-width-expand dedecms-album-preview-remark" type="text" value="${remark}" onkeyup="dedecmsAlbumPreviewEdit(this)">\n                                </div>\n                            </div>\n                        </div>\n                    </div>`;albumPreview.append(html),albumUploadData.push({id:id,src:src,remark:remark}),albumUploadFiles.val(JSON.stringify(albumUploadData))},reader.readAsDataURL(file)}})),$(that).val("")}function dedecmsAlbumPreviewDelete(that){let div=$(that).parent().parent().parent().parent(),id=div.attr("id"),albumUploadFiles=$("#dedecms-album-upload-files");albumUploadData=objArrayRemove(albumUploadData,"id",id),albumUploadFiles.val(JSON.stringify(albumUploadData)),div.remove()}function dedecmsAlbumPreviewEdit(that){let files=$(that).prop("files");if(files){let file=files[0];if(void 0===file)return;if(/\.(jpe?g|png|gif)$/i.test(file.name)){let reader=new FileReader;reader.onload=function(){let img=$(that).next(),input=$(that).parent().next().children().children("input"),src=this.result,remark=file.name.substring(0,file.name.lastIndexOf("."));img.attr("src",src),input.val(remark),input.attr("value",input.val()),dedecmsAlbumUploadDataUpdate(),$(that).val("")},reader.readAsDataURL(file)}}else $(that).attr("value",$(that).val()),dedecmsAlbumUploadDataUpdate()}function dedecmsAlbumUploadDataUpdate(){let id=[],src=[],remark=[],albumUploadDataLength=albumUploadData.length,albumUploadFiles=$("#dedecms-album-upload-files");$(".dedecms-album-preview-id").each((function(){id.push($(this).attr("id"))})),$(".dedecms-album-preview-src").each((function(){src.push($(this).attr("src"))})),$(".dedecms-album-preview-remark").each((function(){remark.push($(this).val())})),albumUploadData=[];for(let i=0;i<id.length&&(albumUploadData.push({id:id[i],src:src[i],remark:remark[i]}),!(i+1>=albumUploadDataLength));i++);albumUploadFiles.val(JSON.stringify(albumUploadData))}$(document).ready((function(){dedecmsAlbumDataUpdate()})),UIkit.util.on(document,"moved","#dedecms-album",(function(item){dedecmsAlbumDataUpdate()})),UIkit.util.on(document,"moved","#dedecms-album-preview",(function(item){dedecmsAlbumUploadDataUpdate()}));